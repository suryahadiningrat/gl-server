#!/bin/sh

# Quick Guide - Grid Merge Workflow

echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
echo "  GRID MERGE - Quick Reference Guide"
echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
echo ""

echo "ğŸ“‹ CONCEPT:"
echo "  Grid layer (dari QGIS) dimerge ke glmap.mbtiles SEKALI SAJA"
echo "  Next run hanya merge drone imagery baru"
echo ""

echo "ğŸ¯ FIRST TIME SETUP:"
echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
echo "1. Convert grid di QGIS â†’ grid_layer.mbtiles"
echo "2. Upload ke server: /app/data/grid_layer.mbtiles"
echo "3. Run: ./generate-config-incremental.sh"
echo ""
echo "   Result:"
echo "   âœ“ Grid merged to glmap.mbtiles (one-time)"
echo "   âœ“ All drone files merged to glmap.mbtiles"
echo "   âœ“ Flag created: .grid_merged"
echo ""

echo "âš¡ UPLOAD FILE BARU (Fast Mode):"
echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
echo "1. Upload: new_drone_123.mbtiles to /app/data/"
echo "2. Run: ./generate-config-incremental.sh"
echo ""
echo "   Result:"
echo "   âœ“ Grid merge SKIPPED (flag exists)"
echo "   âœ“ Only new file merged (~2-5 seconds!)"
echo ""

echo "ğŸ”§ MAINTENANCE COMMANDS:"
echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
echo ""
echo "# Check grid status:"
echo "  [ -f /app/data/.grid_merged ] && echo 'Grid already merged' || echo 'Not merged'"
echo ""
echo "# Check merged drone files:"
echo "  wc -l /app/data/.merged_files.log"
echo ""
echo "# Check glmap tiles count:"
echo "  sqlite3 /app/data/glmap.mbtiles 'SELECT COUNT(*) FROM tiles;'"
echo ""
echo "# View merged files list:"
echo "  cat /app/data/.merged_files.log"
echo ""

echo "ğŸ”„ RESET OPTIONS:"
echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
echo ""
echo "Option 1: Reset grid merge only"
echo "  rm /app/data/.grid_merged"
echo "  rm /app/data/glmap.mbtiles"
echo "  ./generate-config-incremental.sh"
echo ""
echo "Option 2: Reset drone merge (keep grid)"
echo "  rm /app/data/.merged_files.log"
echo "  rm /app/data/glmap.mbtiles"
echo "  ./generate-config-incremental.sh"
echo ""
echo "Option 3: Nuclear reset (everything from scratch)"
echo "  rm /app/data/.grid_merged"
echo "  rm /app/data/.merged_files.log"
echo "  rm /app/data/glmap.mbtiles"
echo "  ./generate-config-incremental.sh"
echo ""

echo "ğŸ“Š FILE STRUCTURE:"
echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
echo "/app/data/"
echo "  â”œâ”€â”€ grid_layer.mbtiles       # Grid original (from QGIS)"
echo "  â”œâ”€â”€ glmap.mbtiles             # Merged: grid + drones"
echo "  â”œâ”€â”€ .grid_merged              # Flag: grid already merged"
echo "  â”œâ”€â”€ .merged_files.log         # Log: drone files merged"
echo "  â””â”€â”€ *.mbtiles                 # Individual drone files"
echo ""

echo "âœ… VALIDATION:"
echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
echo ""
echo "# Check grid tiles in glmap:"
echo "  sqlite3 /app/data/glmap.mbtiles \\"
echo "    'SELECT COUNT(*) FROM tiles WHERE zoom_level < 10;'"
echo ""
echo "# Check drone tiles in glmap:"
echo "  sqlite3 /app/data/glmap.mbtiles \\"
echo "    'SELECT COUNT(*) FROM tiles WHERE zoom_level >= 15;'"
echo ""
echo "# List all tables:"
echo "  sqlite3 /app/data/glmap.mbtiles '.tables'"
echo ""
echo "# View metadata:"
echo "  sqlite3 /app/data/glmap.mbtiles 'SELECT * FROM metadata;'"
echo ""

echo "âš ï¸  IMPORTANT:"
echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
echo "â€¢ Grid layer merge hanya 1x (efisien!)"
echo "â€¢ Jangan hapus grid_layer.mbtiles (untuk reset)"
echo "â€¢ Flag .grid_merged control grid merge behavior"
echo "â€¢ Backup .merged_files.log untuk track history"
echo ""

echo "ğŸš€ TYPICAL WORKFLOW:"
echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
echo ""
echo "Day 1: First setup"
echo "  ./generate-config-incremental.sh  â†’ 3-5 minutes"
echo ""
echo "Day 2: Upload 1 new file"
echo "  ./generate-config-incremental.sh  â†’ 2-5 seconds âš¡"
echo ""
echo "Day 3: Upload 5 new files"
echo "  ./generate-config-incremental.sh  â†’ 10-25 seconds âš¡"
echo ""
echo "Week 2: Total 100 files"
echo "  ./generate-config-incremental.sh  â†’ Still 2-5 sec per new file!"
echo ""

echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
echo "  Ready to use! Run: ./generate-config-incremental.sh"
echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
